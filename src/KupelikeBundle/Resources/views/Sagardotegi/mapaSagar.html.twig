{% extends 'base.html.twig' %}

{% block body %}
<div class="row">
  <div class="col-md-12">
    <div class="caja">
      <h1 class="text-center mtitle">{{ sagardotegi.nombre }}</h1>
    
    <div id="map" class="mapa"></div>

        <script>
      function myMap() {
        
        var directionsService = new google.maps.DirectionsService;
        var directionsDisplay = new google.maps.DirectionsRenderer;
        var infowindow = new google.maps.InfoWindow(); 
        //Creando el mapa
        var mapCanvas = document.getElementById("map");
        var mapOptions = {
          center: new google.maps.LatLng({{ sagardotegi.latitud }},{{ sagardotegi.longitud }}), 
          zoom: 17,
          scrollwheel: false
        };
        var map = new google.maps.Map(mapCanvas, mapOptions);
        directionsDisplay.setMap(map);
        directionsDisplay.setOptions( { suppressMarkers: true } );
        
        
        //Creando los iconos
        var kupImg="../../../../../web/img/logoblanco35.png";
        //var kupImg="https://kupelike-oalba.c9users.io/web/img/botellasidra2.png";
    		var sagarImg={
    			url:kupImg,
    			size: new google.maps.Size(35, 35)
    		};
		
    		var perImg="../../../../../web/img/personaPos.png";
    		//var perImg="https://kupelike-oalba.c9users.io/web/img/personaPos.png";
    		var persImg={
    			url:perImg,
    			size: new google.maps.Size(35, 35)
    		};
		
		    //Colocando marcadores
        var sagarPos = {lat: {{ sagardotegi.latitud }}, lng: {{ sagardotegi.longitud }}};
        var sagardotegi = new google.maps.Marker({
          position: sagarPos,
          map: map,
          title: '{{ sagardotegi.nombre }}',
          icon: sagarImg
        });
        
        infowindow.setContent('{{ sagardotegi.nombre }}<br>{{sagardotegi.direccion}}');
        sagardotegi.addListener('click', function() {
          infowindow.open(map, sagardotegi);
          map.setCenter(sagardotegi.position);
        });
        
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(position) {
            var perPos = {
              lat: position.coords.latitude,
              lng: position.coords.longitude
            };
            var persona = new google.maps.Marker({
              position: perPos,
              map: map,
              title: 'Tu posición.',
              icon: persImg
            });
          });
        }

        calculateAndDisplayRoute(directionsService, directionsDisplay);
      }
      
      function calculateAndDisplayRoute(directionsService, directionsDisplay) {
        var sagarPos = {lat: {{ sagardotegi.latitud }}, lng: {{ sagardotegi.longitud }}};
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(position) {
            var perPos = {
              lat: position.coords.latitude,
              lng: position.coords.longitude
            };
            
            directionsService.route({
              origin: perPos,
              destination: sagarPos,
              travelMode: google.maps.TravelMode.DRIVING
            }, function(response, status) {
              if (status === google.maps.DirectionsStatus.OK) {
                directionsDisplay.setDirections(response);
              } else {
                window.alert('Fallo al mostrar la dirección ' + status);
              }
            });
          });
        }
      }
        </script>
        <script src="https://maps.googleapis.com/maps/api/js?callback=myMap"></script>
    </div>
  </div>
</div>
    
{% endblock %}